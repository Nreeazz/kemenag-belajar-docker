name: Build Docker Images with Versioning
on:
    push:
        tags:
            - *-rc

env:
RELEASE_VERSION: ${{ steps.vars.outputs.tag }}

jobs:
    checkout-build-push:
        runs-on: ubuntu-latest
        steps:
            - name: checkout
              uses: actions/checkout@v3
            - name: Build Docker Image
              run: |
                docker build -t ghcr.io/nreeazz/aplikasi-laravel:$RELEASE_VERSION  ./laravel
            - name: Login 
              run: echo '${{ secrets.TOKEN }}' | docker login ghcr.io -u nreeazz --password-stdin
            - name: push
              run: docker push ghcr.io/nreeazz/aplikasi-laravel:$RELEASE_VERSION